CREATE TABLE IF NOT EXISTS USERS (
    ID UUID PRIMARY KEY,
    NAME VARCHAR(255) NOT NULL,
    BIRTHDAY DATE NOT NULL,
    DOCUMENT_NUMBER VARCHAR(255) NOT NULL
);

CREATE TABLE IF NOT EXISTS EXCHANGES (
    ID UUID PRIMARY KEY,
    NAME VARCHAR(255) NOT NULL,
    MINIMUM_AGE INTEGER NOT NULL,
    MAXIMUM_TRANSFER_AMOUNT DECIMAL(15,2) NOT NULL
);

CREATE TABLE IF NOT EXISTS ACCOUNTS (
    ID UUID PRIMARY KEY,
    USER_ID UUID NOT NULL,
    EXCHANGE_ID UUID NOT NULL,
    BALANCE DECIMAL(15,2) NOT NULL,
    FOREIGN KEY (USER_ID) REFERENCES USERS(ID),
    FOREIGN KEY (EXCHANGE_ID) REFERENCES EXCHANGES(ID)
);

CREATE TABLE IF NOT EXISTS EXCHANGE_TRANSACTIONS (
    ID UUID PRIMARY KEY,
    EXCHANGE_ID UUID NOT NULL,
    TYPE VARCHAR(255) NOT NULL,
    AMOUNT DECIMAL(15,2) NOT NULL,
    EXECUTED_AT TIMESTAMP NOT NULL,
    FOREIGN KEY (EXCHANGE_ID) REFERENCES EXCHANGES(ID)
);

CREATE OR REPLACE VIEW EXCHANGE_TRANSACTIONS_VIEW AS
    SELECT ET.EXCHANGE_ID, ET.EXECUTED_AT::DATE, ET.TYPE,SUM(ET.AMOUNT) AS AMOUNT
    FROM EXCHANGE_TRANSACTIONS ET
    GROUP BY ET.EXCHANGE_ID, ET.EXECUTED_AT::DATE, ET.TYPE;

-- Seed data for USERS table
INSERT INTO USERS (ID, NAME, BIRTHDAY, DOCUMENT_NUMBER) VALUES
    ('550e8400-e29b-41d4-a716-446655440001', 'John Doe', '1990-05-15', '123456789'),
    ('550e8400-e29b-41d4-a716-446655440002', 'Jane Smith', '1985-08-22', '987654321'),
    ('550e8400-e29b-41d4-a716-446655440003', 'Carlos Rodriguez', '1992-03-10', '456789123'),
    ('550e8400-e29b-41d4-a716-446655440004', 'Emily Johnson', '1988-11-30', '789123456'),
    ('550e8400-e29b-41d4-a716-446655440005', 'Michael Brown', '1995-07-25', '321654987')
ON CONFLICT (ID) DO NOTHING;

-- Seed data for EXCHANGES table
INSERT INTO EXCHANGES (ID, NAME, MINIMUM_AGE, MAXIMUM_TRANSFER_AMOUNT) VALUES
    ('660e8400-e29b-41d4-a716-446655440001', 'Binance', 18, 100000.00),
    ('660e8400-e29b-41d4-a716-446655440002', 'Coinbase', 18, 50000.00),
    ('660e8400-e29b-41d4-a716-446655440003', 'Kraken', 21, 75000.00),
    ('660e8400-e29b-41d4-a716-446655440004', 'Gemini', 18, 25000.00),
    ('660e8400-e29b-41d4-a716-446655440005', 'FTX', 21, 150000.00)
ON CONFLICT (ID) DO NOTHING;

-- Seed data for ACCOUNTS table
INSERT INTO ACCOUNTS (ID, USER_ID, EXCHANGE_ID, BALANCE) VALUES
    ('770e8400-e29b-41d4-a716-446655440001', '550e8400-e29b-41d4-a716-446655440001', '660e8400-e29b-41d4-a716-446655440001', 5000.00),
    ('770e8400-e29b-41d4-a716-446655440002', '550e8400-e29b-41d4-a716-446655440001', '660e8400-e29b-41d4-a716-446655440002', 2500.00),
    ('770e8400-e29b-41d4-a716-446655440003', '550e8400-e29b-41d4-a716-446655440002', '660e8400-e29b-41d4-a716-446655440001', 10000.00),
    ('770e8400-e29b-41d4-a716-446655440004', '550e8400-e29b-41d4-a716-446655440003', '660e8400-e29b-41d4-a716-446655440003', 7500.00),
    ('770e8400-e29b-41d4-a716-446655440005', '550e8400-e29b-41d4-a716-446655440004', '660e8400-e29b-41d4-a716-446655440004', 3000.00),
    ('770e8400-e29b-41d4-a716-446655440006', '550e8400-e29b-41d4-a716-446655440005', '660e8400-e29b-41d4-a716-446655440005', 15000.00),
    ('770e8400-e29b-41d4-a716-446655440007', '550e8400-e29b-41d4-a716-446655440002', '660e8400-e29b-41d4-a716-446655440003', 8500.00)
ON CONFLICT (ID) DO NOTHING;

-- Seed data for EXCHANGE_TRANSACTIONS table
INSERT INTO EXCHANGE_TRANSACTIONS (ID, EXCHANGE_ID, TYPE, AMOUNT, EXECUTED_AT) VALUES
    ('880e8400-e29b-41d4-a716-446655440001', '660e8400-e29b-41d4-a716-446655440001', 'DEPOSIT', 5000.00, '2025-12-01 10:30:00'),
    ('880e8400-e29b-41d4-a716-446655440002', '660e8400-e29b-41d4-a716-446655440001', 'WITHDRAW', 1500.00, '2025-12-02 14:15:00'),
    ('880e8400-e29b-41d4-a716-446655440003', '660e8400-e29b-41d4-a716-446655440002', 'DEPOSIT', 2500.00, '2025-12-03 09:45:00'),
    ('880e8400-e29b-41d4-a716-446655440004', '660e8400-e29b-41d4-a716-446655440001', 'DEPOSIT', 10000.00, '2025-12-05 11:00:00'),
    ('880e8400-e29b-41d4-a716-446655440005', '660e8400-e29b-41d4-a716-446655440003', 'DEPOSIT', 7500.00, '2025-12-07 16:30:00'),
    ('880e8400-e29b-41d4-a716-446655440006', '660e8400-e29b-41d4-a716-446655440003', 'WITHDRAW', 2000.00, '2025-12-08 13:20:00'),
    ('880e8400-e29b-41d4-a716-446655440007', '660e8400-e29b-41d4-a716-446655440004', 'DEPOSIT', 3000.00, '2025-12-10 08:00:00'),
    ('880e8400-e29b-41d4-a716-446655440008', '660e8400-e29b-41d4-a716-446655440005', 'DEPOSIT', 15000.00, '2025-12-12 17:45:00'),
    ('880e8400-e29b-41d4-a716-446655440009', '660e8400-e29b-41d4-a716-446655440002', 'WITHDRAW', 500.00, '2025-12-15 12:00:00'),
    ('880e8400-e29b-41d4-a716-446655440010', '660e8400-e29b-41d4-a716-446655440001', 'DEPOSIT', 3500.00, '2025-12-18 10:00:00'),
    ('880e8400-e29b-41d4-a716-446655440011', '660e8400-e29b-41d4-a716-446655440003', 'DEPOSIT', 8500.00, '2025-12-20 15:30:00'),
    ('880e8400-e29b-41d4-a716-446655440012', '660e8400-e29b-41d4-a716-446655440005', 'WITHDRAW', 5000.00, '2025-12-21 09:15:00')
ON CONFLICT (ID) DO NOTHING;